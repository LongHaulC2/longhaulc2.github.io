"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[847],{9688(e,t,n){n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"02 Implants/Modules/Overview & Modifications","title":"Modules","description":"Modules are the implant\'s core capabilities. Implemented as distinct C++ functions, they handle specific host interactions (like directory traversal or file I/O).","source":"@site/docs/02 Implants/Modules/00. Overview & Modifications.md","sourceDirName":"02 Implants/Modules","slug":"/02 Implants/Modules/Overview & Modifications","permalink":"/02 Implants/Modules/Overview & Modifications","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":0,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Commands","permalink":"/02 Implants/Commands"},"next":{"title":"cd.cpp","permalink":"/02 Implants/Modules/cd.cpp"}}');var r=n(4848),o=n(8453);const i={},a="Modules",l={},d=[{value:"Return Structure: <code>ModuleResult</code>",id:"return-structure-moduleresult",level:2}];function c(e){const t={blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"modules",children:"Modules"})}),"\n",(0,r.jsx)(t.p,{children:"Modules are the implant's core capabilities. Implemented as distinct C++ functions, they handle specific host interactions (like directory traversal or file I/O)."}),"\n",(0,r.jsxs)(t.p,{children:["These modules serve as the ",(0,r.jsx)(t.strong,{children:"default implementation"})," for standard C2 activities. They are designed with the following principles:"]}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Modular & Isolated:"})," Each command is isolated in its own function."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Replaceable:"})," Because they utilize standard C++ and WinAPI calls, you can easily modify the logic (e.g., swapping ",(0,r.jsx)(t.code,{children:"CreateFileW"})," for a lower-level NTAPI call) or replace the module entirely without breaking the core C2 architecture."]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Standardized:"})," All modules communicate with the core using a unified return structure, ensuring consistent error handling and data parsing."]}),"\n"]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"You are strongly encouraged to implement your own unique behavior within the implant modules. Modifying the default logic and execution flow is an effective way to disrupt static signatures and bypass heuristic detection mechanisms."}),"\n"]}),"\n",(0,r.jsxs)(t.h2,{id:"return-structure-moduleresult",children:["Return Structure: ",(0,r.jsx)(t.code,{children:"ModuleResult"})]}),"\n",(0,r.jsxs)(t.p,{children:["To maintain consistency between the implant, the GUI, and the API, every module returns a standardized ",(0,r.jsx)(t.code,{children:"ModuleResult"})," structure. This loose contract allows the core to handle data and errors uniformly, regardless of what the specific module actually does."]}),"\n",(0,r.jsxs)(t.p,{children:["This standardization shifts the burden of logic ",(0,r.jsx)(t.em,{children:"into"})," the modules (i.e. the modules choose if they were successful or not, and what to return) and keeps the core commandtree.cpp lightweight. Instead of writing custom handling code for every new feature, the core simply serializes whatever ",(0,r.jsx)(t.code,{children:"ModuleResult"}),' it receives. This makes the implant significantly more robust, as there is only one "pipeline" for data to travel through.']}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"The Structure:"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-cpp",children:"struct ModuleResult {\n    std::string data;           // Success output (e.g., file contents, directory listing)\n    DWORD windows_error_code;   // The associated WinAPI Error code. Ex, ERROR_SUCCESS, ERROR_ACCESS_DENIED.\n};\n\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Here's a snippet of the ",(0,r.jsx)(t.code,{children:"CD"})," branch of the command tree, which calls ",(0,r.jsx)(t.code,{children:"cd"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-cpp",children:'//Don\'t worry about this snippet, it\'s just an example of what the parent caller looks like, \n//and how it handles the responses from each module. \n\n//Calling our module\nModuleResult module_result = cd(directory_to_traverse_to);\nstd::string data = module_result.data;\nDWORD windows_error_code = module_result.windows_error_code;\n\n//adding results to the task response message\nadd_text_result(result, "message", GetErrorMessage(windows_error_code));\nadd_int_result(result, "windows_error_code", windows_error_code);\nadd_text_result(result, "data", data);\n'})}),"\n",(0,r.jsxs)(t.p,{children:["And the snipped of the ",(0,r.jsx)(t.code,{children:"cd"})," function that is called. Notice, as mentioned above, the logic for what to return is done by the module itself."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-cpp",children:'#include <windows.h>\n\n/**\n * @brief Changes current directory.\n * @param std::string path_name: The path to CD to\n * @return ModuleResult\n */\nModuleResult cd(std::string path_name) {\n\tBOOL result = SetCurrentDirectory(\n\t\tpath_name.c_str()\n\t);\n\n\t//https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-setcurrentdirectory\n\tif (result == 0) {\n\t\t//if 0, it means something failed, so call GetLastError() to see what that is. \n\t\t// no data to send back, leave it empty\n\t\treturn { "", GetLastError()};\n\t}\n\t//on success return ERROR_SUCCESS\n\t// no data to send back, leave it empty\n\treturn { "", ERROR_SUCCESS };\n}\n'})})]})}function u(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,t,n){n.d(t,{R:()=>i,x:()=>a});var s=n(6540);const r={},o=s.createContext(r);function i(e){const t=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),s.createElement(o.Provider,{value:t},e.children)}}}]);